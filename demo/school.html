<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart School Integrated Dashboard</title>
    <link rel="icon" type="image/x-icon" href="../assets/favicon.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="./custom-styles.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      @font-face {
        font-family: "SUIT-Regular";
        src: url("../SUIT-Regular.woff2") format("woff2");
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }

      body {
        font-family: "SUIT-Regular", -apple-system, BlinkMacSystemFont,
          "Segoe UI", Roboto, sans-serif;
        font-weight: 400;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      /* Scrollbar Styling */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      ::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
      }
      canvas {
        display: block;
        width: 100%;
        height: 100%;
      }
      #sidebar {
        transition: transform 0.3s ease-in-out, margin-left 0.3s ease-in-out;
        transform: translateX(0);
        width: 280px;
        flex-shrink: 0;
      }

      #sidebar.sidebar-closed {
        transform: translateX(-100%);
        margin-left: -280px;
      }

      /* Main content transition for smooth adjustment */
      .main-content {
        transition: margin-left 0.3s ease-in-out;
      }

      /* Prevent layout shift on hover by removing font-weight change */
      .no-layout-shift {
        position: relative;
      }
      .no-layout-shift::after {
        content: attr(data-text);
        font-weight: bold;
        position: absolute;
        left: 0;
        opacity: 0;
        visibility: hidden;
      }

      /* Sidebar Item Styles from user request */
      .sidebar-item {
        display: flex;
        align-items: center;
        gap: 0.75rem; /* gap-x-3 */
        cursor: pointer;
        color: #000000; /* text-black */
        transition: background-color 0.2s, color 0.2s;
        font-weight: 500;
      }
      .sidebar-item:hover {
        color: #111827; /* hover:text-gray-900 */
      }
      .active-sidebar-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        background-color: #e5f1ff;
        color: #0075ff;
        font-weight: 500;
      }
      /* Submenu items inside accordion - smaller font and consistent height */
      .accordion-content .sidebar-item,
      .accordion-content .active-sidebar-item {
        font-size: 14px;
        padding: 12px;
        min-height: 48px;
        margin-top: 4px;
        margin-bottom: 4px;
        border-radius: 0.375rem;
      }
      /* Accordion animation */
      .accordion-content {
        overflow: hidden;
        transition: max-height 0.3s ease-in-out;
      }

      /* Modal styles for printing */
      @media print {
        body * {
          visibility: hidden;
        }
        .printable-area,
        .printable-area * {
          visibility: visible;
        }
        .printable-area {
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
        }
        .modal-header,
        .modal-footer {
          display: none !important;
        }
      }
    </style>
  </head>
  <body class="bg-[#f8f8f8]">
    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 bg-white border-b shadow-2 z-50">
      <div
        class="max-h-16 overflow-hidden ease flex w-full flex-col justify-start px-5 transition-[max-height] duration-150 sm:flex-row sm:items-center sm:justify-between sm:overflow-visible sm:border-none"
      >
        <div class="my-auto flex min-h-16 items-center gap-3 sm:gap-4">
          <button
            id="sidebar-toggle-btn"
            aria-controls="sidebar"
            class="stroke-gray-600"
          >
            <svg
              width="32"
              height="32"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              class="aspect-square w-6 shrink-0"
            >
              <path
                id="sidebar-toggle-icon-close"
                d="M20 24L12 16L20 8"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
              <path
                id="sidebar-toggle-icon-open"
                d="M6 8H26M6 16H26M6 24H26"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="hidden"
              ></path>
            </svg>
          </button>
          <a class="block" href="#/">
            <img
              src="../assets/logo-nav.png"
              alt="Logo"
              class="max-h-16 w-auto"
            />
          </a>
          <div
            class="hidden line-clamp-1 w-fit whitespace-nowrap text-2xl font-bold text-gray-800"
          >
            Smart School Integrated Dashboard
          </div>
        </div>
        <ul
          class="relative z-50 my-auto flex min-h-16 w-full justify-center gap-2 sm:border-none"
        >
          <div
            class="flex flex-1 items-center gap-3 whitespace-nowrap text-base text-gray-700 max-sm:flex-wrap"
          >
            <nav
              aria-label="Main"
              data-orientation="horizontal"
              dir="ltr"
              class="relative z-10 flex flex-1 items-center w-full max-w-full justify-evenly sm:justify-end"
            >
              <div style="position: relative gap-y-1">
                <ul
                  data-orientation="horizontal"
                  class="group flex flex-1 list-none items-center justify-center space-x-1"
                  dir="ltr"
                >
                  <li class="flex flex-1 justify-center">
                    <button
                      class="group inline-flex items-center justify-center rounded-md py-2 transition-colors hover:bg-transparent hover:text-accent-foreground focus:bg-transparent focus:text-accent-foreground focus:outline-none disabled:opacity-50 data-[active]:bg-transparent date-[active]:text-primary data-[state=open]:bg-transparent group group h-13 w-full px-0 text-lg font-bold disabled:pointer-events-auto disabled:cursor-not-allowed disabled:text-gray-500"
                    >
                      <div>
                        <svg
                          width="24"
                          height="24"
                          viewBox="0 0 24 24"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-6 w-6 group-data-[state=open]:text-primary"
                        >
                          <path
                            d="M7 21L3 17L7 13"
                            stroke="#0f172a"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          ></path>
                          <path
                            d="M17 17H3"
                            stroke="#0f172a"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          ></path>
                          <path
                            d="M17 3L21 7L17 11"
                            stroke="#0f172a"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          ></path>
                          <path
                            d="M7 7H21"
                            stroke="#0f172a"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          ></path>
                        </svg>
                      </div>
                    </button>
                  </li>
                  <li>
                    <div
                      class="mx-2 my-auto h-3 w-px shrink-0 bg-grayscale-600"
                    ></div>
                  </li>
                  <li class="flex flex-1 justify-center">
                    <button
                      class="group inline-flex items-center justify-center rounded-md py-2 font-medium transition-colors hover:bg-transparent hover:text-accent-foreground focus:bg-transparent focus:text-accent-foreground focus:outline-none disabled:opacity-50 data-[active]:bg-transparent date-[active]:text-primary data-[state=open]:bg-transparent group group h-13 w-full bg-white px-0 text-lg disabled:pointer-events-auto disabled:cursor-not-allowed disabled:text-gray-500"
                    >
                      <div class="flex items-center gap-1.5">
                        <svg
                          width="24"
                          height="24"
                          viewBox="0 0 24 24"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-6 w-6 group-data-[state=open]:text-primary"
                        >
                          <path
                            d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21"
                            stroke="#0f172a"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          ></path>
                          <path
                            d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z"
                            stroke="#0f172a"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          ></path>
                        </svg>
                        <div
                          class="my-auto hidden text-grayscale-300 group-data-[state=open]:text-primary sm:flex no-layout-shift"
                          data-text="admin"
                        >
                          admin
                        </div>
                      </div>
                    </button>
                  </li>
                </ul>
              </div>
              <div
                class="absolute left-auto top-full flex justify-center right-auto sm:-right-4 lg:-right-5"
              ></div>
            </nav>
          </div>
        </ul>
      </div>
    </header>

    <div class="flex h-screen pt-16">
      <!-- New Sidebar -->
      <aside
        id="sidebar"
        class="z-40 bg-white shadow-lg rounded-2xl ml-5 my-5 border border-solid border-grayscale-700"
      >
        <div class="no-scrollbar flex flex-col h-full overflow-y-auto">
          <nav id="lnb" class="p-4 text-lg font-medium">
            <ul class="flex flex-col gap-1.5 mt-[1px]">
              <li class="py-[2px]">
                <div
                  id="nav-dashboard"
                  data-page-id="dashboard"
                  title="Dashboard"
                  class="active-sidebar-item"
                >
                  <svg
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z"
                    ></path>
                    <path
                      d="M9 22V14H15V22"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    ></path>
                  </svg>
                  <span class="flex-grow truncate leading-[22px]"
                    >Dashboard</span
                  >
                </div>
              </li>
              <li class="py-[2px]">
                <div
                  id="nav-environment"
                  data-page-id="environment"
                  title="Environment"
                  class="sidebar-item"
                >
                  <svg
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.657 7.343A8 8 0 0117.657 18.657z"
                    ></path>
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9.879 16.121A3 3 0 1014.12 11.88l-4.242 4.242z"
                    ></path>
                  </svg>
                  <span class="flex-grow truncate leading-[22px]"
                    >Environment</span
                  >
                </div>
              </li>
              <!-- Accordion Item -->
              <li class="relative w-full">
                <button
                  type="button"
                  id="accordion-safety"
                  aria-controls="safety-submenu"
                  aria-expanded="false"
                  data-state="closed"
                  class="flex flex-1 items-center justify-between font-medium transition-all w-full sidebar-item p-0 rounded-lg"
                >
                  <div
                    title="Safety Management"
                    class="flex max-w-[calc(100%-4rem)] flex-1 items-center gap-x-3 p-3"
                  >
                    <svg
                      class="w-6 h-6 shrink-0"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                      ></path>
                    </svg>
                    <span class="flex-grow text-left truncate">Safety</span>
                  </div>
                  <div class="p-3">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                      class="arrow h-6 w-6 shrink-0 transition-transform duration-200"
                    >
                      <path
                        d="M6 9L12 15L18 9"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      ></path>
                    </svg>
                  </div>
                </button>
                <div
                  id="safety-submenu"
                  role="region"
                  class="accordion-content pl-8"
                  style="max-height: 0px"
                >
                  <ul class="flex flex-col gap-1.5 py-2">
                    <li class="py-[2px]">
                      <div
                        id="nav-fire-safety"
                        data-page-id="fire-safety"
                        class="sidebar-item text-base"
                      >
                        Fire Detection
                      </div>
                    </li>
                    <li class="py-[2px]">
                      <div
                        id="nav-emergency-alert"
                        data-page-id="emergency-alert"
                        class="sidebar-item text-base"
                      >
                        Emergency Alert
                      </div>
                    </li>
                    <li class="py-[2px]">
                      <div
                        id="nav-danger-zone"
                        data-page-id="danger-zone"
                        class="sidebar-item text-base"
                      >
                        Danger Zone
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="py-[2px]">
                <div
                  id="nav-access-control"
                  data-page-id="access-control"
                  title="Access Control"
                  class="sidebar-item"
                >
                  <svg
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M8 11V7a4 4 0 118 0v4M5 9h14l1 12H4L5 9z"
                    ></path>
                  </svg>
                  <span class="flex-grow truncate leading-[22px]"
                    >Access Control</span
                  >
                </div>
              </li>
              <li class="py-[2px]">
                <div
                  id="nav-attendance"
                  data-page-id="attendance"
                  title="Smart Attendance"
                  class="sidebar-item"
                >
                  <svg
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                    ></path>
                  </svg>
                  <span class="flex-grow truncate leading-[22px]"
                    >Smart Attendance</span
                  >
                </div>
              </li>
            </ul>
          </nav>
        </div>
      </aside>

      <!-- Main Content Area -->
      <div class="main-content flex-1 flex flex-col overflow-hidden">
        <main class="flex-1 p-6 overflow-y-auto">
          <!-- Page Container -->
          <div id="page-content">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="hidden">
              <!-- Page Title -->
              <div class="mb-6">
                <h2 class="text-[30px] font-bold text-gray-800">
                  Smart School Integrated Dashboard
                </h2>
                <p class="text-sm text-gray-500">
                  Check the safety and environmental status of the entire school
                  at a glance.
                </p>
              </div>
              <!-- KPI Summary -->
              <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4">
                <div class="p-5 bg-white rounded-lg shadow">
                  <div class="flex items-center">
                    <div class="p-3 bg-blue-100 rounded-full">
                      <svg
                        class="w-6 h-6 text-blue-500"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                        ></path>
                      </svg>
                    </div>
                    <div class="ml-4">
                      <p class="text-sm font-medium text-gray-500">
                        Real-time Occupancy
                      </p>
                      <p class="text-2xl font-bold text-gray-800">
                        345 <span class="text-sm font-normal">People</span>
                      </p>
                    </div>
                  </div>
                </div>
                <div class="p-5 bg-white rounded-lg shadow">
                  <div class="flex items-center">
                    <div class="p-3 bg-yellow-100 rounded-full">
                      <svg
                        class="w-6 h-6 text-yellow-500"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                        ></path>
                      </svg>
                    </div>
                    <div class="ml-4">
                      <p class="text-sm font-medium text-gray-500">
                        Environment Alerts
                      </p>
                      <p class="text-2xl font-bold text-gray-800">
                        5 <span class="text-sm font-normal">Cases</span>
                      </p>
                    </div>
                  </div>
                </div>
                <div class="p-5 bg-white rounded-lg shadow">
                  <div class="flex items-center">
                    <div class="p-3 bg-red-100 rounded-full">
                      <svg
                        class="w-6 h-6 text-red-500"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"
                        ></path>
                      </svg>
                    </div>
                    <div class="ml-4">
                      <p class="text-sm font-medium text-gray-500">
                        Access/Security Alerts
                      </p>
                      <p class="text-2xl font-bold text-gray-800">
                        2 <span class="text-sm font-normal">Cases</span>
                      </p>
                    </div>
                  </div>
                </div>
                <div class="p-5 bg-white rounded-lg shadow">
                  <div class="flex items-center">
                    <div class="p-3 bg-purple-100 rounded-full">
                      <svg
                        class="w-6 h-6 text-purple-500"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                        ></path>
                      </svg>
                    </div>
                    <div class="ml-4">
                      <p class="text-sm font-medium text-gray-500">
                        Alarms (Last 24h)
                      </p>
                      <p class="text-2xl font-bold text-gray-800">
                        3 <span class="text-sm font-normal">Cases</span>
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Main Content Grid -->
              <div class="grid grid-cols-1 gap-6 mt-6 lg:grid-cols-3">
                <!-- School Map View -->
                <div class="lg:col-span-2 p-6 bg-white rounded-lg shadow">
                  <h3 class="text-lg font-semibold text-gray-800">
                    Real-time School Status
                  </h3>
                  <div class="relative mt-4 h-96 bg-gray-200 rounded-lg">
                    <img
                      src="https://storage.googleapis.com/gemini-prod-us-west1-409903-assets/409903_1722421111623_Gambar-4.webp"
                      alt="School Map"
                      class="object-contain w-full h-full rounded-lg"
                      onerror="this.onerror=null;this.src='https://placehold.co/800x400/E2E8F0/4A5568?text=Image+Load+Failed';"
                    />
                    <div class="absolute" style="top: 35%; left: 30%">
                      <div class="relative flex flex-col items-center group">
                        <span
                          class="w-4 h-4 bg-red-500 rounded-full animate-pulse"
                        ></span>
                        <div
                          class="absolute bottom-0 flex-col items-center hidden mb-6 group-hover:flex"
                        >
                          <span
                            class="relative z-10 p-2 text-xs leading-none text-white whitespace-no-wrap bg-black shadow-lg rounded-md"
                            >2F Hallway (Fall Detected)</span
                          >
                          <div class="w-3 h-3 -mt-2 rotate-45 bg-black"></div>
                        </div>
                      </div>
                    </div>
                    <div class="absolute" style="top: 45%; left: 70%">
                      <div class="relative flex flex-col items-center group">
                        <span
                          class="w-4 h-4 bg-yellow-400 rounded-full animate-pulse"
                        ></span>
                        <div
                          class="absolute bottom-0 flex-col items-center hidden mb-6 group-hover:flex"
                        >
                          <span
                            class="relative z-10 p-2 text-xs leading-none text-white whitespace-no-wrap bg-black shadow-lg rounded-md"
                            >Class 3-2 (CO₂ Alert)</span
                          >
                          <div class="w-3 h-3 -mt-2 rotate-45 bg-black"></div>
                        </div>
                      </div>
                    </div>
                    <div class="absolute" style="top: 60%; left: 25%">
                      <div class="relative flex flex-col items-center group">
                        <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                        <div
                          class="absolute bottom-0 flex-col items-center hidden mb-6 group-hover:flex"
                        >
                          <span
                            class="relative z-10 p-2 text-xs leading-none text-white whitespace-no-wrap bg-black shadow-lg rounded-md"
                            >Class 3-1 (Normal)</span
                          >
                          <div class="w-3 h-3 -mt-2 rotate-45 bg-black"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Event Log List -->
                <div class="p-6 bg-white rounded-lg shadow">
                  <h3 class="text-lg font-semibold text-gray-800">
                    Real-time Event Log
                  </h3>
                  <div class="mt-4 space-y-4 overflow-y-auto h-96">
                    <div class="flex items-start p-3 bg-red-50 rounded-lg">
                      <div
                        class="w-3 h-3 mt-1 bg-red-500 rounded-full flex-shrink-0"
                      ></div>
                      <div class="ml-3">
                        <p class="text-sm font-semibold text-red-800">
                          [Access] Unauthorized access to rooftop
                        </p>
                        <p class="text-xs text-gray-500">Just now</p>
                      </div>
                    </div>
                    <div class="flex items-start p-3 bg-red-50 rounded-lg">
                      <div
                        class="w-3 h-3 mt-1 bg-red-500 rounded-full flex-shrink-0"
                      ></div>
                      <div class="ml-3">
                        <p class="text-sm font-semibold text-red-800">
                          [Safety] Fall detected in 2F hallway
                        </p>
                        <p class="text-xs text-gray-500">5 mins ago</p>
                      </div>
                    </div>
                    <div class="flex items-start p-3 bg-yellow-50 rounded-lg">
                      <div
                        class="w-3 h-3 mt-1 bg-yellow-500 rounded-full flex-shrink-0"
                      ></div>
                      <div class="ml-3">
                        <p class="text-sm font-semibold text-yellow-800">
                          [Env] Class 3-2 CO₂ level 'Warning'
                        </p>
                        <p class="text-xs text-gray-500">30 mins ago</p>
                      </div>
                    </div>
                    <div class="flex items-start p-3 bg-gray-50 rounded-lg">
                      <div
                        class="w-3 h-3 mt-1 bg-gray-500 rounded-full flex-shrink-0"
                      ></div>
                      <div class="ml-3">
                        <p class="text-sm font-semibold text-gray-800">
                          [Attend] Student John Doe is late
                        </p>
                        <p class="text-xs text-gray-500">1 hour ago</p>
                      </div>
                    </div>
                    <div class="flex items-start p-3 bg-gray-50 rounded-lg">
                      <div
                        class="w-3 h-3 mt-1 bg-gray-500 rounded-full flex-shrink-0"
                      ></div>
                      <div class="ml-3">
                        <p class="text-sm font-semibold text-gray-800">
                          [System] Server room maintenance complete
                        </p>
                        <p class="text-xs text-gray-500">3 hours ago</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Quick Controls & Monthly Chart -->
              <div class="grid grid-cols-1 gap-6 mt-6 lg:grid-cols-2">
                <div class="p-6 bg-white rounded-lg shadow">
                  <h3 class="text-lg font-semibold text-gray-800">
                    Quick Controls
                  </h3>
                  <div class="grid grid-cols-2 gap-4 mt-4">
                    <button
                      class="flex flex-col items-center justify-center p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition"
                    >
                      <svg
                        class="w-8 h-8 text-blue-500"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.636 5.636a9 9 0 0112.728 0M18.364 18.364A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"
                        ></path>
                      </svg>
                      <span class="mt-2 text-sm font-semibold text-blue-800"
                        >Global Ventilation</span
                      >
                    </button>
                    <button
                      class="flex flex-col items-center justify-center p-4 bg-red-50 rounded-lg hover:bg-red-100 transition"
                    >
                      <img
                        src="../assets/megaphone.svg"
                        alt="Megaphone"
                        class="w-8 h-8"
                        style="
                          filter: invert(24%) sepia(70%) saturate(7485%)
                            hue-rotate(351deg) brightness(91%) contrast(93%);
                        "
                      />
                      <span class="mt-2 text-sm font-semibold text-red-800"
                        >Emergency Broadcast</span
                      >
                    </button>
                    <button
                      id="comprehensive-report-btn"
                      class="flex flex-col items-center justify-center p-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition"
                    >
                      <svg
                        class="w-8 h-8 text-gray-500"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                        ></path>
                      </svg>
                      <span class="mt-2 text-sm font-semibold text-gray-800"
                        >Generate Comprehensive Report</span
                      >
                    </button>
                  </div>
                </div>
                <div class="p-6 bg-white rounded-lg shadow">
                  <h3 class="text-lg font-semibold text-gray-800">
                    Monthly Event Trends
                  </h3>
                  <div class="h-48 mt-4">
                    <canvas id="monthlyEventChart"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Environment Page -->
            <div id="environment-page" class="hidden">
              <div class="mb-6">
                <h2 class="text-[30px] font-bold text-gray-800">
                  Environment Management
                </h2>
                <p class="text-sm text-gray-500">
                  Monitor and control the school's environmental conditions.
                </p>
              </div>
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 space-y-6">
                  <!-- Real-time Sensor Panel -->
                  <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Real-time Sensor Panel by Area
                    </h3>
                    <div
                      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mt-4"
                    >
                      <div class="p-4 border rounded-lg">
                        <div class="flex justify-between items-center">
                          <span class="font-bold text-gray-700">Class 3-1</span
                          ><span
                            class="w-3 h-3 bg-green-500 rounded-full"
                            title="Normal"
                          ></span>
                        </div>
                        <div class="mt-2 space-y-1 text-sm">
                          <p>CO₂: <span class="font-semibold">850 ppm</span></p>
                          <p>Temp: <span class="font-semibold">24.5℃</span></p>
                          <p>
                            Humidity: <span class="font-semibold">55%</span>
                          </p>
                        </div>
                      </div>
                      <div
                        class="p-4 border border-yellow-400 bg-yellow-50 rounded-lg"
                      >
                        <div class="flex justify-between items-center">
                          <span class="font-bold text-gray-700">Class 3-2</span
                          ><span
                            class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"
                            title="Warning"
                          ></span>
                        </div>
                        <div class="mt-2 space-y-1 text-sm">
                          <p>
                            CO₂:
                            <span class="font-semibold text-yellow-700"
                              >1,300 ppm</span
                            >
                          </p>
                          <p>Temp: <span class="font-semibold">26.1℃</span></p>
                          <p>
                            Humidity: <span class="font-semibold">60%</span>
                          </p>
                        </div>
                      </div>
                      <div
                        class="p-4 border border-red-400 bg-red-50 rounded-lg"
                      >
                        <div class="flex justify-between items-center">
                          <span class="font-bold text-gray-700"
                            >Science Lab</span
                          ><span
                            class="w-3 h-3 bg-red-500 rounded-full animate-pulse"
                            title="Danger"
                          ></span>
                        </div>
                        <div class="mt-2 space-y-1 text-sm">
                          <p>
                            PM2.5:
                            <span class="font-semibold text-red-700"
                              >150 µg/m³</span
                            >
                          </p>
                          <p>Temp: <span class="font-semibold">23.8℃</span></p>
                          <p>
                            Humidity: <span class="font-semibold">52%</span>
                          </p>
                        </div>
                      </div>
                      <div class="p-4 border rounded-lg">
                        <div class="flex justify-between items-center">
                          <span class="font-bold text-gray-700">Music Room</span
                          ><span
                            class="w-3 h-3 bg-green-500 rounded-full"
                            title="Normal"
                          ></span>
                        </div>
                        <div class="mt-2 space-y-1 text-sm">
                          <p>CO₂: <span class="font-semibold">720 ppm</span></p>
                          <p>Temp: <span class="font-semibold">24.1℃</span></p>
                          <p>
                            Humidity: <span class="font-semibold">58%</span>
                          </p>
                        </div>
                      </div>
                      <div class="p-4 border rounded-lg">
                        <div class="flex justify-between items-center">
                          <span class="font-bold text-gray-700">Library</span
                          ><span
                            class="w-3 h-3 bg-green-500 rounded-full"
                            title="Normal"
                          ></span>
                        </div>
                        <div class="mt-2 space-y-1 text-sm">
                          <p>CO₂: <span class="font-semibold">900 ppm</span></p>
                          <p>Temp: <span class="font-semibold">25.0℃</span></p>
                          <p>
                            Humidity: <span class="font-semibold">50%</span>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- Trend Chart -->
                  <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Trend Chart (Class 3-2 CO₂ Level)
                    </h3>
                    <div class="h-64 mt-4">
                      <canvas id="envTrendChart"></canvas>
                    </div>
                  </div>
                </div>
                <!-- Right Control/Settings Panel -->
                <div class="space-y-6">
                  <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Automation Settings
                    </h3>
                    <div class="mt-4 space-y-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700"
                          >If CO₂ exceeds 1000ppm</label
                        >
                        <div class="flex items-center justify-between mt-1">
                          <span>Auto-open windows</span
                          ><label
                            class="inline-flex items-center cursor-pointer"
                            ><input
                              type="checkbox"
                              value=""
                              class="sr-only peer"
                              checked />
                            <div
                              class="relative w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"
                            ></div
                          ></label>
                        </div>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700"
                          >If temperature exceeds 28℃</label
                        >
                        <div class="flex items-center justify-between mt-1">
                          <span>Auto-turn on A/C</span
                          ><label
                            class="inline-flex items-center cursor-pointer"
                            ><input
                              type="checkbox"
                              value=""
                              class="sr-only peer"
                              checked />
                            <div
                              class="relative w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"
                            ></div
                          ></label>
                        </div>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700"
                          >If PM2.5 is 'Bad'</label
                        >
                        <div class="flex items-center justify-between mt-1">
                          <span>Auto-turn on air purifier</span
                          ><label
                            class="inline-flex items-center cursor-pointer"
                            ><input
                              type="checkbox"
                              value=""
                              class="sr-only peer"
                              checked />
                            <div
                              class="relative w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"
                            ></div
                          ></label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">Reports</h3>
                    <button
                      id="download-report-btn"
                      class="w-full mt-4 py-2 px-4 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700"
                    >
                      Download Monthly Report (PDF)
                    </button>
                  </div>
                  <!-- Real-time Environment Events -->
                  <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Real-time Environment Events
                    </h3>
                    <div class="mt-4 space-y-3 overflow-y-auto h-40">
                      <div class="flex items-start p-2 bg-yellow-50 rounded-lg">
                        <div
                          class="w-2.5 h-2.5 mt-1 bg-yellow-500 rounded-full flex-shrink-0"
                        ></div>
                        <div class="ml-2">
                          <p class="text-sm font-semibold text-yellow-800">
                            [Warning] Class 3-2 CO₂ level exceeded
                          </p>
                          <p class="text-xs text-gray-500">35 mins ago</p>
                        </div>
                      </div>
                      <div class="flex items-start p-2 bg-red-50 rounded-lg">
                        <div
                          class="w-2.5 h-2.5 mt-1 bg-red-500 rounded-full flex-shrink-0"
                        ></div>
                        <div class="ml-2">
                          <p class="text-sm font-semibold text-red-800">
                            [Danger] Science Lab PM2.5
                          </p>
                          <p class="text-xs text-gray-500">1 hour ago</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Fire Safety Page -->
            <div id="fire-safety-page" class="hidden">
              <div class="mb-6">
                <h2 class="text-[30px] font-bold text-gray-800">
                  Fire Safety Management
                </h2>
                <p class="text-sm text-gray-500">
                  Monitor fire-related sensors and manage responses.
                </p>
              </div>
              <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                <!-- Left Column -->
                <div class="lg:col-span-3 space-y-6">
                  <!-- CCTV & Vision Analysis -->
                  <div class="p-6 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      AI Vision Detection CCTV
                    </h3>
                    <div class="mt-4 grid grid-cols-2 gap-4">
                      <div
                        class="relative col-span-2 bg-black rounded-lg h-72 overflow-hidden"
                      >
                        <video
                          src="https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4"
                          autoplay
                          muted
                          loop
                          class="w-full h-full object-cover"
                        ></video>
                        <div
                          class="absolute top-2 left-2 p-2 bg-black/50 text-white text-xs rounded"
                        >
                          CCTV-01 (Cafeteria)
                        </div>
                        <div
                          class="absolute bottom-2 left-2 p-2 bg-red-500/80 text-white text-sm rounded animate-pulse"
                        >
                          AI Analysis: Smoke Detected (98% confidence)
                        </div>
                      </div>
                      <div
                        class="relative bg-black rounded-lg h-40 overflow-hidden"
                      >
                        <video
                          src="https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4"
                          autoplay
                          muted
                          loop
                          class="w-full h-full object-cover"
                        ></video>
                        <div
                          class="absolute top-2 left-2 p-2 bg-black/50 text-white text-xs rounded"
                        >
                          CCTV-02 (Hallway)
                        </div>
                      </div>
                      <div
                        class="relative bg-black rounded-lg h-40 overflow-hidden"
                      >
                        <video
                          src="https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4"
                          autoplay
                          muted
                          loop
                          class="w-full h-full object-cover"
                        ></video>
                        <div
                          class="absolute top-2 left-2 p-2 bg-black/50 text-white text-xs rounded"
                        >
                          CCTV-03 (Stairs)
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- IoT Sensor Data -->
                  <div class="p-6 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      IoT Sensor Data
                    </h3>
                    <div
                      class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-center"
                    >
                      <div
                        class="p-3 bg-red-50 border border-red-200 rounded-lg"
                      >
                        <p class="text-sm font-bold">Smoke (Cafeteria)</p>
                        <p class="text-lg font-semibold text-red-600 mt-1">
                          Detected
                        </p>
                      </div>
                      <div
                        class="p-3 bg-green-50 border border-green-200 rounded-lg"
                      >
                        <p class="text-sm font-bold">Heat (Cafeteria)</p>
                        <p class="text-lg font-semibold text-green-600 mt-1">
                          Normal
                        </p>
                      </div>
                      <div
                        class="p-3 bg-green-50 border border-green-200 rounded-lg"
                      >
                        <p class="text-sm font-bold">Smoke (Hallway)</p>
                        <p class="text-lg font-semibold text-green-600 mt-1">
                          Normal
                        </p>
                      </div>
                      <div
                        class="p-3 bg-green-50 border border-green-200 rounded-lg"
                      >
                        <p class="text-sm font-bold">Sprinkler</p>
                        <p class="text-lg font-semibold text-green-600 mt-1">
                          Normal
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Right Column -->
                <div class="lg:col-span-2 space-y-6">
                  <div class="p-6 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Emergency Response
                    </h3>
                    <div class="mt-4 space-y-3">
                      <button
                        class="w-full py-3 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700"
                      >
                        Initiate Evacuation Broadcast
                      </button>
                      <button
                        class="w-full py-3 px-4 bg-yellow-500 text-white font-semibold rounded-lg hover:bg-yellow-600"
                      >
                        Send Emergency Alert to All Staff
                      </button>
                    </div>
                  </div>
                  <div class="p-6 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Alarm History
                    </h3>
                    <div class="mt-4 space-y-3 overflow-y-auto h-32">
                      <div class="text-sm p-2 bg-gray-50 rounded">
                        <p class="font-semibold">
                          [09:15] Smoke detected in Cafeteria
                        </p>
                        <p class="text-xs text-gray-600">
                          Action: Admin confirmed
                        </p>
                      </div>
                      <div class="text-sm p-2 bg-gray-50 rounded">
                        <p class="font-semibold">
                          [Yesterday 14:22] High temp in Science Lab
                        </p>
                        <p class="text-xs text-gray-600">
                          Action: Auto-alert sent
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="p-6 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Monthly Alarm Stats
                    </h3>
                    <div class="h-48 mt-4">
                      <canvas id="fireMonthlyChart"></canvas>
                    </div>
                  </div>
                  <div class="p-6 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Alarm Stats by Location
                    </h3>
                    <div class="h-48 mt-4">
                      <canvas id="fireLocationChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Emergency Alert Page -->
            <div id="emergency-alert-page" class="hidden">
              <div class="mb-6">
                <h2 class="text-[30px] font-bold text-gray-800">
                  Emergency Alert
                </h2>
                <p class="text-sm text-gray-500">
                  Monitor and respond to AI-detected emergency events.
                </p>
              </div>
              <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Left Column -->
                <div class="lg:col-span-1 space-y-6">
                  <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Detected Events
                    </h3>
                    <div
                      id="event-list"
                      class="mt-4 space-y-3 overflow-y-auto h-[calc(100vh-22rem)]"
                    >
                      <div
                        class="event-item p-4 rounded-lg border-2 border-red-500 bg-red-50 cursor-pointer active"
                        data-event-type="fight"
                      >
                        <p class="font-bold text-red-700">Fight Detected</p>
                        <p class="text-sm text-gray-600">
                          Location: 2F Hallway
                        </p>
                        <p class="text-xs text-gray-500">Time: 2 mins ago</p>
                      </div>
                      <div
                        class="event-item p-4 rounded-lg border bg-yellow-50 cursor-pointer"
                        data-event-type="fall"
                      >
                        <p class="font-bold text-yellow-700">Fall Detected</p>
                        <p class="text-sm text-gray-600">
                          Location: Playground
                        </p>
                        <p class="text-xs text-gray-500">Time: 15 mins ago</p>
                      </div>
                      <div
                        class="event-item p-4 rounded-lg border cursor-pointer hover:bg-gray-50"
                        data-event-type="shout"
                      >
                        <p class="font-bold text-gray-700">Shout Detected</p>
                        <p class="text-sm text-gray-600">
                          Location: 3F Restroom
                        </p>
                        <p class="text-xs text-gray-500">
                          Time: 1 hour ago (Closed)
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Event Statistics
                    </h3>
                    <div class="h-48 mt-4">
                      <canvas id="emergencyEventChart"></canvas>
                    </div>
                  </div>
                </div>
                <!-- Right Column: Event Details -->
                <div
                  id="event-details"
                  class="lg:col-span-3 bg-white p-6 rounded-lg shadow"
                >
                  <!-- Details will be populated by JS -->
                </div>
              </div>
            </div>

            <!-- Danger Zone Page -->
            <div id="danger-zone-page" class="hidden">
              <div class="mb-6">
                <h2 class="text-[30px] font-bold text-gray-800">
                  Danger Zone Monitoring
                </h2>
                <p class="text-sm text-gray-500">
                  Monitor restricted areas for unauthorized access.
                </p>
              </div>
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- CCTV Monitoring -->
                <div class="lg:col-span-2 space-y-6">
                  <div class="p-6 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Real-time CCTV Monitoring
                    </h3>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div
                        class="relative bg-black rounded-lg h-64 overflow-hidden border-4 border-red-500 animate-pulse"
                      >
                        <video
                          src="https://storage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4"
                          autoplay
                          muted
                          loop
                          class="w-full h-full object-cover"
                        ></video>
                        <div
                          class="absolute top-2 left-2 p-2 bg-black/50 text-white text-xs rounded"
                        >
                          CCTV-21 (Rooftop)
                        </div>
                        <div
                          class="absolute bottom-2 left-2 p-2 bg-red-500/80 text-white text-sm rounded"
                        >
                          AI Analysis: Person Detected!
                        </div>
                        <div
                          class="absolute border-2 border-red-500"
                          style="top: 30%; left: 40%; width: 20%; height: 60%"
                        ></div>
                      </div>
                      <div
                        class="relative bg-black rounded-lg h-64 overflow-hidden"
                      >
                        <video
                          src="https://storage.googleapis.com/gtv-videos-bucket/sample/VolkswagenGTIReview.mp4"
                          autoplay
                          muted
                          loop
                          class="w-full h-full object-cover"
                        ></video>
                        <div
                          class="absolute top-2 left-2 p-2 bg-black/50 text-white text-xs rounded"
                        >
                          CCTV-22 (Machine Room)
                        </div>
                      </div>
                      <div
                        class="relative bg-black rounded-lg h-64 overflow-hidden"
                      >
                        <video
                          src="https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4"
                          autoplay
                          muted
                          loop
                          class="w-full h-full object-cover"
                        ></video>
                        <div
                          class="absolute top-2 left-2 p-2 bg-black/50 text-white text-xs rounded"
                        >
                          CCTV-23 (Warehouse)
                        </div>
                      </div>
                      <div
                        class="relative bg-black rounded-lg h-64 overflow-hidden"
                      >
                        <video
                          src="https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
                          autoplay
                          muted
                          loop
                          class="w-full h-full object-cover"
                        ></video>
                        <div
                          class="absolute top-2 left-2 p-2 bg-black/50 text-white text-xs rounded"
                        >
                          CCTV-24 (Boiler Room)
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Logs and Settings -->
                <div class="space-y-6">
                  <div class="p-6 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Danger Zone Detection Log
                    </h3>
                    <div class="mt-4 space-y-3 overflow-y-auto h-64">
                      <div class="flex items-start p-2 bg-red-50 rounded-lg">
                        <div
                          class="w-2.5 h-2.5 mt-1 bg-red-500 rounded-full flex-shrink-0"
                        ></div>
                        <div class="ml-2">
                          <p class="text-sm font-semibold text-red-800">
                            [Alert] Unauthorized access to Rooftop
                          </p>
                          <p class="text-xs text-gray-500">1 min ago</p>
                        </div>
                      </div>
                      <div class="flex items-start p-2 bg-yellow-50 rounded-lg">
                        <div
                          class="w-2.5 h-2.5 mt-1 bg-yellow-500 rounded-full flex-shrink-0"
                        ></div>
                        <div class="ml-2">
                          <p class="text-sm font-semibold text-yellow-800">
                            [Warning] Extended stay in Warehouse
                          </p>
                          <p class="text-xs text-gray-500">30 mins ago</p>
                        </div>
                      </div>
                      <div class="flex items-start p-2 bg-gray-50 rounded-lg">
                        <div
                          class="w-2.5 h-2.5 mt-1 bg-gray-400 rounded-full flex-shrink-0"
                        ></div>
                        <div class="ml-2">
                          <p class="text-sm font-semibold text-gray-800">
                            [Info] Staff entered Machine Room
                          </p>
                          <p class="text-xs text-gray-500">2 hours ago</p>
                        </div>
                      </div>
                      <div class="flex items-start p-2 bg-red-50 rounded-lg">
                        <div
                          class="w-2.5 h-2.5 mt-1 bg-red-500 rounded-full flex-shrink-0"
                        ></div>
                        <div class="ml-2">
                          <p class="text-sm font-semibold text-red-800">
                            [Alert] AI detected throwing action on Rooftop
                          </p>
                          <p class="text-xs text-gray-500">3 hours ago</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="p-6 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800">
                      Danger Zone Settings
                    </h3>
                    <div class="mt-4 space-y-2 text-sm">
                      <div
                        class="flex justify-between items-center p-2 bg-gray-50 rounded"
                      >
                        <span>Rooftop</span
                        ><button class="text-xs text-gray-500 hover:text-black">
                          Settings
                        </button>
                      </div>
                      <div
                        class="flex justify-between items-center p-2 bg-gray-50 rounded"
                      >
                        <span>Machine Room</span
                        ><button class="text-xs text-gray-500 hover:text-black">
                          Settings
                        </button>
                      </div>
                      <div
                        class="flex justify-between items-center p-2 bg-gray-50 rounded"
                      >
                        <span>Warehouse</span
                        ><button class="text-xs text-gray-500 hover:text-black">
                          Settings
                        </button>
                      </div>
                    </div>
                    <button
                      class="w-full mt-3 py-2 px-4 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700"
                    >
                      Add New Zone
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Access Control Page -->
            <div id="access-control-page" class="hidden">
              <div class="mb-6">
                <h2 class="text-[30px] font-bold text-gray-800">
                  Access Control
                </h2>
                <p class="text-sm text-gray-500">
                  View access logs and real-time camera feeds.
                </p>
              </div>
              <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow">
                  <h3 class="text-lg font-semibold text-gray-800">
                    Access Log Dashboard
                  </h3>
                  <div class="mt-4 overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                      <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                          <th scope="col" class="px-6 py-3">Time</th>
                          <th scope="col" class="px-6 py-3">Location</th>
                          <th scope="col" class="px-6 py-3">Name/Photo</th>
                          <th scope="col" class="px-6 py-3">Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr class="bg-white border-b hover:bg-gray-50">
                          <td class="px-6 py-4">10:15:31</td>
                          <td class="px-6 py-4">Back Gate</td>
                          <td class="px-6 py-4 flex items-center">
                            <img
                              src="https://placehold.co/32x32/E2E8F0/4A5568?text=C"
                              class="rounded-full mr-3 w-8 h-8"
                            />Mr. Park (Staff)
                          </td>
                          <td class="px-6 py-4">
                            <span
                              class="px-2 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full"
                              >Success</span
                            >
                          </td>
                        </tr>
                        <tr class="bg-red-50 border-b hover:bg-red-100">
                          <td class="px-6 py-4">09:45:12</td>
                          <td class="px-6 py-4">Server Room</td>
                          <td class="px-6 py-4 flex items-center">
                            <img
                              src="https://placehold.co/32x32/E2E8F0/4A5568?text=D"
                              class="rounded-full mr-3 w-8 h-8"
                            />Minjun Choi (Student)
                          </td>
                          <td class="px-6 py-4">
                            <span
                              class="px-2 py-1 text-xs font-medium text-red-800 bg-red-100 rounded-full"
                              >Failed (No Auth)</span
                            >
                          </td>
                        </tr>
                        <tr class="bg-white border-b hover:bg-gray-50">
                          <td class="px-6 py-4">09:05:12</td>
                          <td class="px-6 py-4">Main Gate</td>
                          <td class="px-6 py-4 flex items-center">
                            <img
                              src="https://placehold.co/32x32/E2E8F0/4A5568?text=A"
                              class="rounded-full mr-3 w-8 h-8"
                            />Mr. Kim (Teacher)
                          </td>
                          <td class="px-6 py-4">
                            <span
                              class="px-2 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full"
                              >Success</span
                            >
                          </td>
                        </tr>
                        <tr class="bg-red-50 border-b hover:bg-red-100">
                          <td class="px-6 py-4">09:01:30</td>
                          <td class="px-6 py-4">Rooftop Door</td>
                          <td class="px-6 py-4 flex items-center">
                            <img
                              src="https://placehold.co/32x32/FECACA/991B1B?text=?"
                              class="rounded-full mr-3 w-8 h-8"
                            />Unknown
                          </td>
                          <td class="px-6 py-4">
                            <span
                              class="px-2 py-1 text-xs font-medium text-red-800 bg-red-100 rounded-full"
                              >Failed (Face ID)</span
                            >
                          </td>
                        </tr>
                        <tr class="bg-white border-b hover:bg-gray-50">
                          <td class="px-6 py-4">08:55:45</td>
                          <td class="px-6 py-4">Class 3-1</td>
                          <td class="px-6 py-4 flex items-center">
                            <img
                              src="https://placehold.co/32x32/E2E8F0/4A5568?text=B"
                              class="rounded-full mr-3 w-8 h-8"
                            />Younghee Lee (Student)
                          </td>
                          <td class="px-6 py-4">
                            <span
                              class="px-2 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full"
                              >Success</span
                            >
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                  <h3 class="text-lg font-semibold text-gray-800">
                    Main Area Real-time CCTV
                  </h3>
                  <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div
                      class="relative bg-black rounded-lg h-48 overflow-hidden"
                    >
                      <video
                        src="https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4"
                        autoplay
                        muted
                        loop
                        class="w-full h-full object-cover"
                      ></video>
                      <div
                        class="absolute top-2 left-2 p-2 bg-black/50 text-white text-xs rounded"
                      >
                        Main Gate
                      </div>
                    </div>
                    <div
                      class="relative bg-black rounded-lg h-48 overflow-hidden"
                    >
                      <video
                        src="https://storage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4"
                        autoplay
                        muted
                        loop
                        class="w-full h-full object-cover"
                      ></video>
                      <div
                        class="absolute top-2 left-2 p-2 bg-black/50 text-white text-xs rounded"
                      >
                        Back Gate
                      </div>
                    </div>
                    <div
                      class="relative bg-black rounded-lg h-48 overflow-hidden"
                    >
                      <video
                        src="https://storage.googleapis.com/gtv-videos-bucket/sample/WeAreGoingOnBullrun.mp4"
                        autoplay
                        muted
                        loop
                        class="w-full h-full object-cover"
                      ></video>
                      <div
                        class="absolute top-2 left-2 p-2 bg-black/50 text-white text-xs rounded"
                      >
                        1F Lobby
                      </div>
                    </div>
                    <div
                      class="relative bg-black rounded-lg h-48 overflow-hidden"
                    >
                      <video
                        src="https://storage.googleapis.com/gtv-videos-bucket/sample/WhatCarCanYouGetForAGrand.mp4"
                        autoplay
                        muted
                        loop
                        class="w-full h-full object-cover"
                      ></video>
                      <div
                        class="absolute top-2 left-2 p-2 bg-black/50 text-white text-xs rounded"
                      >
                        Playground
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Smart Attendance Page -->
            <div id="attendance-page" class="hidden">
              <div class="mb-6">
                <h2 class="text-[30px] font-bold text-gray-800">
                  Smart Attendance
                </h2>
                <p class="text-sm text-gray-500">
                  View real-time attendance status for students.
                </p>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="p-5 bg-white rounded-lg shadow text-center">
                  <p class="text-lg font-semibold text-gray-700">
                    3rd Grade Total
                  </p>
                  <p class="text-4xl font-bold text-gray-800 mt-2">240</p>
                </div>
                <div class="p-5 bg-white rounded-lg shadow text-center">
                  <p class="text-lg font-semibold text-green-700">Present</p>
                  <p class="text-4xl font-bold text-green-600 mt-2">235</p>
                </div>
                <div class="p-5 bg-white rounded-lg shadow text-center">
                  <p class="text-lg font-semibold text-red-700">Late/Absent</p>
                  <p class="text-4xl font-bold text-red-600 mt-2">5</p>
                </div>
              </div>
              <div class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow">
                  <h3 class="text-lg font-semibold text-gray-800">
                    Real-time Attendance Status by Class
                  </h3>
                  <div
                    class="mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"
                  >
                    <!-- Class Status Cards -->
                    <div class="p-4 border rounded-lg">
                      <h4 class="font-bold">Grade 3, Class 1</h4>
                      <div
                        class="flex justify-between items-center mt-2 text-sm"
                      >
                        <span
                          >Present:
                          <span class="font-semibold">29/30</span></span
                        ><span
                          >Late:
                          <span class="font-semibold text-yellow-600"
                            >0</span
                          ></span
                        ><span
                          >Absent:
                          <span class="font-semibold text-red-600"
                            >1</span
                          ></span
                        >
                      </div>
                    </div>
                    <div class="p-4 border rounded-lg">
                      <h4 class="font-bold">Grade 3, Class 2</h4>
                      <div
                        class="flex justify-between items-center mt-2 text-sm"
                      >
                        <span
                          >Present:
                          <span class="font-semibold">30/30</span></span
                        ><span>Late: <span class="font-semibold">0</span></span
                        ><span
                          >Absent: <span class="font-semibold">0</span></span
                        >
                      </div>
                    </div>
                    <div class="p-4 border rounded-lg">
                      <h4 class="font-bold">Grade 3, Class 3</h4>
                      <div
                        class="flex justify-between items-center mt-2 text-sm"
                      >
                        <span
                          >Present:
                          <span class="font-semibold">28/30</span></span
                        ><span
                          >Late:
                          <span class="font-semibold text-yellow-600"
                            >2</span
                          ></span
                        ><span
                          >Absent: <span class="font-semibold">0</span></span
                        >
                      </div>
                    </div>
                    <div class="p-4 border rounded-lg">
                      <h4 class="font-bold">Grade 3, Class 4</h4>
                      <div
                        class="flex justify-between items-center mt-2 text-sm"
                      >
                        <span
                          >Present:
                          <span class="font-semibold">29/30</span></span
                        ><span>Late: <span class="font-semibold">0</span></span
                        ><span
                          >Absent:
                          <span class="font-semibold text-red-600"
                            >1</span
                          ></span
                        >
                      </div>
                    </div>
                    <div class="p-4 border rounded-lg">
                      <h4 class="font-bold">Grade 3, Class 5</h4>
                      <div
                        class="flex justify-between items-center mt-2 text-sm"
                      >
                        <span
                          >Present:
                          <span class="font-semibold">30/30</span></span
                        ><span>Late: <span class="font-semibold">0</span></span
                        ><span
                          >Absent: <span class="font-semibold">0</span></span
                        >
                      </div>
                    </div>
                    <div class="p-4 border rounded-lg">
                      <h4 class="font-bold">Grade 3, Class 6</h4>
                      <div
                        class="flex justify-between items-center mt-2 text-sm"
                      >
                        <span
                          >Present:
                          <span class="font-semibold">30/30</span></span
                        ><span>Late: <span class="font-semibold">0</span></span
                        ><span
                          >Absent: <span class="font-semibold">0</span></span
                        >
                      </div>
                    </div>
                    <div class="p-4 border rounded-lg">
                      <h4 class="font-bold">Grade 3, Class 7</h4>
                      <div
                        class="flex justify-between items-center mt-2 text-sm"
                      >
                        <span
                          >Present:
                          <span class="font-semibold">29/30</span></span
                        ><span>Late: <span class="font-semibold">0</span></span
                        ><span
                          >Absent:
                          <span class="font-semibold text-red-600"
                            >1</span
                          ></span
                        >
                      </div>
                    </div>
                    <div class="p-4 border rounded-lg">
                      <h4 class="font-bold">Grade 3, Class 8</h4>
                      <div
                        class="flex justify-between items-center mt-2 text-sm"
                      >
                        <span
                          >Present:
                          <span class="font-semibold">30/30</span></span
                        ><span>Late: <span class="font-semibold">0</span></span
                        ><span
                          >Absent: <span class="font-semibold">0</span></span
                        >
                      </div>
                    </div>
                  </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                  <h3 class="text-lg font-semibold text-gray-800">
                    Today's Absent Students
                  </h3>
                  <div class="mt-4 space-y-3 overflow-y-auto h-64">
                    <div
                      class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
                    >
                      <div class="flex items-center">
                        <img
                          src="https://placehold.co/32x32/E2E8F0/4A5568?text=K"
                          class="rounded-full w-8 h-8 mr-3"
                        />
                        <div>
                          <p class="font-semibold text-sm">Minjun Kim</p>
                          <p class="text-xs text-gray-500">Grade 3, Class 1</p>
                        </div>
                      </div>
                      <span class="text-xs font-medium text-red-600">Sick</span>
                    </div>
                    <div
                      class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
                    >
                      <div class="flex items-center">
                        <img
                          src="https://placehold.co/32x32/E2E8F0/4A5568?text=L"
                          class="rounded-full w-8 h-8 mr-3"
                        />
                        <div>
                          <p class="font-semibold text-sm">Seoyeon Lee</p>
                          <p class="text-xs text-gray-500">Grade 3, Class 4</p>
                        </div>
                      </div>
                      <span class="text-xs font-medium text-red-600"
                        >Unapproved</span
                      >
                    </div>
                    <div
                      class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
                    >
                      <div class="flex items-center">
                        <img
                          src="https://placehold.co/32x32/E2E8F0/4A5568?text=P"
                          class="rounded-full w-8 h-8 mr-3"
                        />
                        <div>
                          <p class="font-semibold text-sm">Doyoon Park</p>
                          <p class="text-xs text-gray-500">Grade 3, Class 7</p>
                        </div>
                      </div>
                      <span class="text-xs font-medium text-red-600"
                        >Other</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // --- Elements ---
        const lnb = document.getElementById("lnb");
        const pageContent = document.getElementById("page-content");
        const pages = Array.from(pageContent.children);
        const reportModal = document.getElementById("report-modal");
        const downloadReportBtn = document.getElementById(
          "download-report-btn"
        );
        const closeReportBtn = document.getElementById("close-report-btn");
        const printReportBtn = document.getElementById("print-report-btn");
        const comprehensiveReportModal = document.getElementById(
          "comprehensive-report-modal"
        );
        const comprehensiveReportBtn = document.getElementById(
          "comprehensive-report-btn"
        );
        const closeComprehensiveReportBtn = document.getElementById(
          "close-comprehensive-report-btn"
        );
        const printComprehensiveReportBtn = document.getElementById(
          "print-comprehensive-report-btn"
        );

        let chartInstances = {};

        // --- Sidebar Toggle Logic ---
        const sidebar = document.getElementById("sidebar");
        const toggleBtn = document.getElementById("sidebar-toggle-btn");
        const closeIcon = document.getElementById("sidebar-toggle-icon-close");
        const openIcon = document.getElementById("sidebar-toggle-icon-open");

        if (toggleBtn && sidebar && closeIcon && openIcon) {
          toggleBtn.addEventListener("click", () => {
            sidebar.classList.toggle("sidebar-closed");
            closeIcon.classList.toggle("hidden");
            openIcon.classList.toggle("hidden");
          });
        }

        // --- Accordion Logic ---
        const accordionBtns = lnb.querySelectorAll('button[id^="accordion-"]');
        accordionBtns.forEach((btn) => {
          btn.addEventListener("click", () => {
            const content = document.getElementById(
              btn.getAttribute("aria-controls")
            );
            const isOpen = btn.getAttribute("aria-expanded") === "true";

            btn.setAttribute("aria-expanded", !isOpen);
            btn.setAttribute("data-state", isOpen ? "closed" : "open");

            if (isOpen) {
              content.style.maxHeight = "0px";
            } else {
              content.style.maxHeight = content.scrollHeight + "px";
            }

            // Rotate arrow icon
            const arrow = btn.querySelector(".arrow");
            if (arrow) {
              arrow.style.transform = isOpen
                ? "rotate(0deg)"
                : "rotate(180deg)";
            }
          });
        });

        function renderChartsForPage(pageId) {
          Object.values(chartInstances).forEach((chart) => chart.destroy());
          chartInstances = {};

          if (pageId === "dashboard") {
            const monthlyEventCtx = document
              .getElementById("monthlyEventChart")
              ?.getContext("2d");
            if (monthlyEventCtx) {
              chartInstances.monthlyEvent = new Chart(monthlyEventCtx, {
                type: "bar",
                data: {
                  labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
                  datasets: [
                    {
                      label: "Safety Events",
                      data: [5, 8, 6, 9],
                      backgroundColor: "rgba(239, 68, 68, 0.6)",
                    },
                    {
                      label: "Environment Events",
                      data: [12, 15, 10, 18],
                      backgroundColor: "rgba(234, 179, 8, 0.6)",
                    },
                    {
                      label: "Access Events",
                      data: [3, 2, 5, 1],
                      backgroundColor: "rgba(107, 114, 128, 0.6)",
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  scales: {
                    x: { stacked: true },
                    y: { stacked: true, beginAtZero: true },
                  },
                  plugins: { legend: { position: "top" } },
                },
              });
            }
          } else if (pageId === "environment") {
            const envTrendCtx = document
              .getElementById("envTrendChart")
              ?.getContext("2d");
            if (envTrendCtx) {
              chartInstances.envTrend = new Chart(envTrendCtx, {
                type: "line",
                data: {
                  labels: [
                    "09:00",
                    "10:00",
                    "11:00",
                    "12:00",
                    "13:00",
                    "14:00",
                    "15:00",
                  ],
                  datasets: [
                    {
                      label: "Class 3-2 CO₂ (ppm)",
                      data: [950, 1100, 1050, 1300, 1250, 980, 850],
                      borderColor: "rgb(234, 179, 8)",
                      backgroundColor: "rgba(234, 179, 8, 0.1)",
                      fill: true,
                      tension: 0.2,
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: { legend: { position: "top" } },
                },
              });
            }
          } else if (pageId === "fire-safety") {
            const fireMonthlyCtx = document
              .getElementById("fireMonthlyChart")
              ?.getContext("2d");
            if (fireMonthlyCtx) {
              chartInstances.fireMonthly = new Chart(fireMonthlyCtx, {
                type: "bar",
                data: {
                  labels: ["Apr", "May", "Jun", "Jul"],
                  datasets: [
                    {
                      label: "Monthly Alarms",
                      data: [1, 0, 2, 1],
                      backgroundColor: "rgba(239, 68, 68, 0.6)",
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: { legend: { display: false } },
                },
              });
            }
            const fireLocationCtx = document
              .getElementById("fireLocationChart")
              ?.getContext("2d");
            if (fireLocationCtx) {
              chartInstances.fireLocation = new Chart(fireLocationCtx, {
                type: "doughnut",
                data: {
                  labels: ["Cafeteria", "Science Lab", "Other"],
                  datasets: [
                    {
                      data: [2, 1, 1],
                      backgroundColor: [
                        "rgba(239, 68, 68, 0.8)",
                        "rgba(249, 115, 22, 0.8)",
                        "rgba(107, 114, 128, 0.8)",
                      ],
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: { legend: { position: "top" } },
                },
              });
            }
          } else if (pageId === "emergency-alert") {
            const emergencyEventCtx = document
              .getElementById("emergencyEventChart")
              ?.getContext("2d");
            if (emergencyEventCtx) {
              chartInstances.emergencyEvent = new Chart(emergencyEventCtx, {
                type: "bar",
                data: {
                  labels: ["Fight", "Fall", "Shout"],
                  datasets: [
                    {
                      label: "Events Today",
                      data: [1, 1, 1],
                      backgroundColor: [
                        "rgba(239, 68, 68, 0.6)",
                        "rgba(234, 179, 8, 0.6)",
                        "rgba(107, 114, 128, 0.6)",
                      ],
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  indexAxis: "y",
                  plugins: { legend: { display: false } },
                },
              });
            }
          }
        }

        const eventDetailsContainer = document.getElementById("event-details");
        const eventData = {
          fight: {
            title: "Fight Detected",
            color: "red",
            video:
              "https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
            details: {
              Location: "2F Hallway (CCTV-08)",
              Time: "2025-07-31 10:20:15",
              Type: "AI Violence Detection",
              Confidence: "96%",
              Persons: "2",
            },
          },
          fall: {
            title: "Fall Detected",
            color: "yellow",
            video:
              "https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4",
            details: {
              Location: "Playground (CCTV-12)",
              Time: "2025-07-31 10:05:45",
              Type: "AI Fall Detection",
              Confidence: "99%",
              Persons: "1",
            },
          },
          shout: {
            title: "Shout Detected",
            color: "gray",
            video:
              "https://storage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4",
            details: {
              Location: "3F Restroom (CCTV-15)",
              Time: "2025-07-31 09:21:03",
              Type: "Audio Analysis",
              Confidence: "92%",
              Persons: "1",
            },
          },
        };

        function updateEventDetails(eventType) {
          const data = eventData[eventType];
          if (!data || !eventDetailsContainer) return;

          eventDetailsContainer.innerHTML = `
                    <h3 class="text-lg font-semibold text-gray-800">Event Details: <span class="text-${
                      data.color
                    }-600">${data.title}</span></h3>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-5 gap-6">
                        <div class="md:col-span-3 space-y-6">
                            <div>
                                <h4 class="font-semibold">👁️ CCTV AI Monitoring (Auto-recorded)</h4>
                                <div class="mt-2 bg-black rounded-lg h-72 overflow-hidden relative">
                                    <video src="${
                                      data.video
                                    }" autoplay muted loop class="w-full h-full object-cover"></video>
                                    <div class="absolute bottom-2 left-2 p-1 bg-black/60 text-white text-xs rounded">Event Time ±10s Video</div>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold">🎬 Auto-saved Video Log</h4>
                                <div class="text-sm p-3 bg-gray-50 rounded-lg mt-2">
                                    <p><strong>File:</strong> ${eventType}_detection_${new Date()
            .toISOString()
            .slice(0, 19)
            .replace(/[-T:]/g, "")}.mp4</p>
                                    <p><strong>Path:</strong> /secure/cctv/archive/2025/07/</p>
                                </div>
                            </div>
                        </div>
                        <div class="md:col-span-2 space-y-6">
                            <div>
                                <h4 class="font-semibold">📉 Detection Details</h4>
                                <div class="mt-2 space-y-2 text-sm p-4 bg-gray-50 rounded-lg">
                                    ${Object.entries(data.details)
                                      .map(
                                        ([key, value]) =>
                                          `<p><strong>${key}:</strong> ${value}</p>`
                                      )
                                      .join("")}
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold">🚨 Alert Dispatch</h4>
                                <div class="mt-2 space-y-2 text-sm p-4 bg-gray-50 rounded-lg">
                                    <div class="flex items-center justify-between"><label for="to_admin">Admin Group</label><input type="checkbox" id="to_admin" checked></div>
                                    <div class="flex items-center justify-between"><label for="to_security">Security Team</label><input type="checkbox" id="to_security" checked></div>
                                    <div class="flex items-center justify-between"><label for="to_principal">Principal/VP</label><input type="checkbox" id="to_principal"></div>
                                    <button class="w-full mt-2 py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">Send Manual Alert</button>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold">🧍 SOS Button Status</h4>
                                <div class="mt-2 space-y-2 text-sm p-4 bg-green-50 border border-green-200 rounded-lg">
                                    <p>All SOS buttons: <span class="font-bold text-green-600">Normal</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
        }

        function showPage(pageId) {
          if (!pageId) return;

          pages.forEach((page) => {
            if (page.id !== pageId + "-page") {
              page.classList.add("hidden");
            } else {
              page.classList.remove("hidden");
            }
          });

          const allNavItems = lnb.querySelectorAll("[data-page-id]");
          allNavItems.forEach((item) => {
            const parentButton = item.closest("button");
            const isDirectItem = !parentButton;

            if (item.dataset.pageId === pageId) {
              item.classList.add("active-sidebar-item");
              item.classList.remove("sidebar-item");
              if (parentButton) {
                parentButton.classList.add("active-sidebar-item");
                parentButton.classList.remove("sidebar-item");
              }
            } else {
              item.classList.remove("active-sidebar-item");
              item.classList.add("sidebar-item");
              if (parentButton) {
                parentButton.classList.remove("active-sidebar-item");
                parentButton.classList.add("sidebar-item");
              }
            }
          });

          renderChartsForPage(pageId);

          if (pageId === "emergency-alert") {
            updateEventDetails("fight");
          }
        }

        // --- Event Listeners ---
        lnb.addEventListener("click", function (e) {
          const targetItem = e.target.closest("[data-page-id]");
          if (targetItem) {
            const pageId = targetItem.dataset.pageId;
            showPage(pageId);
          }
        });

        const eventListContainer = document.getElementById("event-list");
        if (eventListContainer) {
          eventListContainer.addEventListener("click", function (e) {
            const targetItem = e.target.closest(".event-item");
            if (!targetItem) return;

            eventListContainer
              .querySelectorAll(".event-item")
              .forEach((item) => {
                item.classList.remove(
                  "active",
                  "border-red-500",
                  "border-yellow-500"
                );
                item.classList.add("border");
              });
            targetItem.classList.add("active");
            if (targetItem.dataset.eventType === "fight") {
              targetItem.classList.add("border-red-500");
            } else if (targetItem.dataset.eventType === "fall") {
              targetItem.classList.add("border-yellow-500");
            }

            const eventType = targetItem.dataset.eventType;
            updateEventDetails(eventType);
          });
        }

        // --- Report Modal Logic ---
        if (downloadReportBtn) {
          downloadReportBtn.addEventListener("click", () => {
            reportModal.classList.remove("hidden");
            reportModal.classList.add("flex");
            const reportChartCtx = document
              .getElementById("reportChart")
              ?.getContext("2d");
            if (reportChartCtx) {
              if (chartInstances.report) chartInstances.report.destroy();
              chartInstances.report = new Chart(reportChartCtx, {
                type: "line",
                data: {
                  labels: Array.from({ length: 31 }, (_, i) => i + 1),
                  datasets: [
                    {
                      label: "Daily Average CO₂ (ppm)",
                      data: Array.from(
                        { length: 31 },
                        () => 800 + Math.random() * 400
                      ),
                      borderColor: "rgba(59, 130, 246, 0.8)",
                      backgroundColor: "rgba(59, 130, 246, 0.1)",
                      fill: true,
                      tension: 0.3,
                    },
                  ],
                },
                options: { responsive: true, maintainAspectRatio: false },
              });
            }
          });
        }

        if (closeReportBtn) {
          closeReportBtn.addEventListener("click", () => {
            reportModal.classList.add("hidden");
            reportModal.classList.remove("flex");
          });
        }

        if (printReportBtn) {
          printReportBtn.addEventListener("click", () => {
            window.print();
          });
        }

        // Close modal when clicking outside
        if (reportModal) {
          reportModal.addEventListener("click", (e) => {
            if (e.target === reportModal) {
              reportModal.classList.add("hidden");
              reportModal.classList.remove("flex");
            }
          });
        }

        // --- Comprehensive Report Modal Logic ---
        if (comprehensiveReportBtn) {
          comprehensiveReportBtn.addEventListener("click", () => {
            comprehensiveReportModal.classList.remove("hidden");
            comprehensiveReportModal.classList.add("flex");
            const comprehensiveChartCtx = document
              .getElementById("comprehensiveReportChart")
              ?.getContext("2d");
            if (comprehensiveChartCtx) {
              if (chartInstances.comprehensive)
                chartInstances.comprehensive.destroy();
              chartInstances.comprehensive = new Chart(comprehensiveChartCtx, {
                type: "radar",
                data: {
                  labels: ["Safety", "Environment", "Access", "Attendance"],
                  datasets: [
                    {
                      label: "Monthly Score (out of 100)",
                      data: [85, 92, 95, 98.5],
                      backgroundColor: "rgba(59, 130, 246, 0.2)",
                      borderColor: "rgba(59, 130, 246, 1)",
                      borderWidth: 1,
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  scales: {
                    r: {
                      beginAtZero: true,
                      max: 100,
                    },
                  },
                },
              });
            }
          });
        }

        if (closeComprehensiveReportBtn) {
          closeComprehensiveReportBtn.addEventListener("click", () => {
            comprehensiveReportModal.classList.add("hidden");
            comprehensiveReportModal.classList.remove("flex");
          });
        }

        if (printComprehensiveReportBtn) {
          printComprehensiveReportBtn.addEventListener("click", () => {
            window.print();
          });
        }

        // Close modal when clicking outside
        if (comprehensiveReportModal) {
          comprehensiveReportModal.addEventListener("click", (e) => {
            if (e.target === comprehensiveReportModal) {
              comprehensiveReportModal.classList.add("hidden");
              comprehensiveReportModal.classList.remove("flex");
            }
          });
        }

        // --- Initial Page Load ---
        showPage("dashboard");
      });
    </script>

    <!-- Environment Report Modal -->
    <div
      id="report-modal"
      class="modal-container fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center"
    >
      <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl">
        <div
          id="report-modal-header"
          class="p-4 border-b flex justify-between items-center modal-header"
        >
          <h3 class="text-xl font-bold">Monthly Environment Report</h3>
          <button
            id="close-report-btn"
            class="text-gray-500 hover:text-gray-800"
          >
            &times;
          </button>
        </div>
        <div
          id="report-modal-content"
          class="p-8 max-h-[70vh] overflow-y-auto bg-white printable-area"
        >
          <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">
              School Environment Monthly Report
            </h1>
            <p class="text-gray-500">July 2025</p>
          </div>
          <div class="grid grid-cols-3 gap-4 text-center mb-8">
            <div class="p-4 bg-blue-50 rounded-lg">
              <p class="text-sm text-blue-800 font-semibold">Avg. CO₂</p>
              <p class="text-2xl font-bold">950 ppm</p>
            </div>
            <div class="p-4 bg-green-50 rounded-lg">
              <p class="text-sm text-green-800 font-semibold">Avg. Temp</p>
              <p class="text-2xl font-bold">24.8℃</p>
            </div>
            <div class="p-4 bg-yellow-50 rounded-lg">
              <p class="text-sm text-yellow-800 font-semibold">Total Alerts</p>
              <p class="text-2xl font-bold">18</p>
            </div>
          </div>
          <div class="mb-8">
            <h2 class="text-xl font-semibold mb-4">
              Daily CO₂ Trend (Avg. of All Areas)
            </h2>
            <div class="h-64"><canvas id="reportChart"></canvas></div>
          </div>
          <div>
            <h2 class="text-xl font-semibold mb-4">Detailed Data by Area</h2>
            <table class="w-full text-sm text-left">
              <thead class="bg-gray-100">
                <tr>
                  <th class="p-2">Area</th>
                  <th class="p-2">Avg. CO₂</th>
                  <th class="p-2">Max CO₂</th>
                  <th class="p-2">Avg. Temp</th>
                  <th class="p-2">Alerts</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b">
                  <td class="p-2 font-medium">Class 3-1</td>
                  <td class="p-2">850 ppm</td>
                  <td class="p-2">980 ppm</td>
                  <td class="p-2">24.5℃</td>
                  <td class="p-2">0</td>
                </tr>
                <tr class="border-b bg-yellow-50">
                  <td class="p-2 font-medium">Class 3-2</td>
                  <td class="p-2">1150 ppm</td>
                  <td class="p-2">1300 ppm</td>
                  <td class="p-2">26.1℃</td>
                  <td class="p-2">12</td>
                </tr>
                <tr class="border-b bg-red-50">
                  <td class="p-2 font-medium">Science Lab</td>
                  <td class="p-2">980 ppm</td>
                  <td class="p-2">1100 ppm</td>
                  <td class="p-2">23.8℃</td>
                  <td class="p-2">6 (PM2.5)</td>
                </tr>
                <tr class="border-b">
                  <td class="p-2 font-medium">Library</td>
                  <td class="p-2">900 ppm</td>
                  <td class="p-2">950 ppm</td>
                  <td class="p-2">25.0℃</td>
                  <td class="p-2">0</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="mt-8">
            <h2 class="text-xl font-semibold mb-4">
              Summary & Recommendations
            </h2>
            <p class="text-sm text-gray-700">
              Overall air quality was maintained at a good level, but Class 3-2
              consistently showed high CO₂ levels during afternoon classes. It
              is recommended to check the ventilation system of Class 3-2 and
              reinforce periodic ventilation guidance.
            </p>
          </div>
        </div>
        <div
          id="report-modal-footer"
          class="p-4 border-t flex justify-end space-x-2 modal-footer"
        >
          <button
            id="print-report-btn"
            class="py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700"
          >
            Print / Save as PDF
          </button>
        </div>
      </div>
    </div>

    <!-- Comprehensive Report Modal -->
    <div
      id="comprehensive-report-modal"
      class="modal-container fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center"
    >
      <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl">
        <div
          id="comprehensive-report-modal-header"
          class="p-4 border-b flex justify-between items-center modal-header"
        >
          <h3 class="text-xl font-bold">Comprehensive Monthly Report</h3>
          <button
            id="close-comprehensive-report-btn"
            class="text-gray-500 hover:text-gray-800"
          >
            &times;
          </button>
        </div>
        <div
          id="comprehensive-report-modal-content"
          class="p-8 max-h-[70vh] overflow-y-auto bg-white printable-area"
        >
          <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">
              Comprehensive School Report
            </h1>
            <p class="text-gray-500">July 2025</p>
          </div>
          <div class="grid grid-cols-2 gap-8 mb-8">
            <div>
              <h2 class="text-xl font-semibold mb-4">Monthly Event Summary</h2>
              <div class="h-64">
                <canvas id="comprehensiveReportChart"></canvas>
              </div>
            </div>
            <div>
              <h2 class="text-xl font-semibold mb-4">Key Metrics</h2>
              <div class="space-y-4">
                <div class="p-4 bg-red-50 rounded-lg">
                  <p class="font-semibold text-red-800">Total Safety Alerts</p>
                  <p class="text-2xl font-bold">28</p>
                </div>
                <div class="p-4 bg-yellow-50 rounded-lg">
                  <p class="font-semibold text-yellow-800">
                    Total Environment Alerts
                  </p>
                  <p class="text-2xl font-bold">55</p>
                </div>
                <div class="p-4 bg-gray-50 rounded-lg">
                  <p class="font-semibold text-gray-800">
                    Unauthorized Access Attempts
                  </p>
                  <p class="text-2xl font-bold">11</p>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg">
                  <p class="font-semibold text-blue-800">
                    Average Attendance Rate
                  </p>
                  <p class="text-2xl font-bold">98.5%</p>
                </div>
              </div>
            </div>
          </div>
          <div class="mt-8">
            <h2 class="text-xl font-semibold mb-4">
              Overall Assessment & Recommendations
            </h2>
            <p class="text-sm text-gray-700">
              The overall school management status for July is stable. However,
              there has been a slight increase in safety alerts in the 2nd week,
              requiring attention to hallway monitoring. Environmental alerts
              are concentrated in specific classrooms, necessitating a
              ventilation system check. Access control and attendance rates are
              being managed well.
            </p>
          </div>
        </div>
        <div
          id="comprehensive-report-modal-footer"
          class="p-4 border-t flex justify-end space-x-2 modal-footer"
        >
          <button
            id="print-comprehensive-report-btn"
            class="py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700"
          >
            Print / Save as PDF
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
